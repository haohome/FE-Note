<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>

    回流与重绘

    1.  回流： 当render tree中的部分(或全部) 因为元素的规模尺寸，比如宽高等，布局等改变而需要重新构建。
               这个重新构建 渲染树 的过程就称为回流(reflow)。
        重绘： 浏览器重新绘制元素到屏幕中的过程称为重绘。

        每个页面至少需要一次回流，就是在页面第一次加载的时候。

    2.  改变宽高等影响布局的属性时，会触发回流，
        并重新构造这部分渲染树，构造完渲染树后，对这些变化的元素进行重绘。

    3.  当一些元素改变外观风格，而不影响布局时，比如改变background-color。
        只触发重绘，不触发回流，因为结构尺寸等没有发生改变。

    注意：回流必将引起重绘，而重绘不一定会引起回流。重绘回流是相当影响性能的。




    回流何时发生：
        当页面布局和几何属性改变时就需要回流。下述情况会发生浏览器回流：

    1、添加或者删除可见的DOM元素；
    2、元素位置改变；
    3、元素尺寸改变——边距、填充、边框、宽度和高度
    4、内容改变——比如文本改变或者图片大小改变而引起的计算值宽度和高度改变；
    5、页面渲染初始化；
    6、浏览器窗口尺寸改变——resize事件发生时；

    
</body>
<script>

    var s = document.body.style;
    s.padding = "2px"; // 回流+重绘
    s.border = "1px solid red"; // 再一次 回流+重绘
    s.color = "blue"; // 再一次重绘
    s.backgroundColor = "#ccc"; // 再一次 重绘
    s.fontSize = "14px"; // 再一次 回流+重绘
    // 添加node，再一次 回流+重绘
    document.body.appendChild(document.createTextNode('abc!'));

    // 几行简单的JS代码就引起了6次左右的回流、重绘, 开销极大


    // 聪明的浏览器：
    // 浏览器都会优化这些操作，浏览器会维护1个队列，把所有会引起回流、重绘的操作放入这个队列，
    // 等队列中的操作到了一定的数量或者到了一定的时间间隔，浏览器就会flush队列，
    // 进行一个批处理。这样就会让多次的回流、重绘变成一次回流重绘。



    // 虽然有了浏览器的优化，但有时候我们写的一些代码可能会强制浏览器提前flush队列，
    // 这样浏览器的优化可能就起不到作用了。比如：
    // 1. offsetTop, offsetLeft, offsetWidth, offsetHeight
    // 2. scrollTop/Left/Width/Height
    // 3. clientTop/Left/Width/Height
    // 4. width,height
    // 5. 请求了getComputedStyle(), 或者 IE的 currentStyle

    // 浏览器为了给你最精确的值, 即使你获取的跟最近改变的无关，也会强行刷新渲染队列。




</script>
</html>